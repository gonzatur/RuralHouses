<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      >
    <h:head>
        <title>Facelet Title</title>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" 
              integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" 
              crossorigin="anonymous"></link>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"></link>
        <link rel="stylesheet" href="css/jquery.fancybox.min.css" /> 
        <link rel="stylesheet" href="css/rh/cabecera.css"></link> 
        <script src="js/jquery-ui.min.js"></script>
        <style>
            #datosDeReserva{
                margin: 15px;
                float: left;
                width: 22%;
            }
            #datosDeReserva label{
                display: block;
                margin: 15px;
            }

            .neg{
                font-size: 20px;
                font-weight: bold;
            }

            .der{
                text-align: right;
                float: right;
            }

            .borderAbajo{
                width: 90px;
                border-bottom: 1px solid;
            }

            .cifra{
                color:black;
                margin:0 !important;
                font-size: 19px;
            }

            #entradaSalida{
                border: 1px solid;
            }

            #desglosePrecio{
                border: 1px solid;
            }

            #pagoAnticipado{
                border: 1px solid;
            }

            #cabeceraDatos{
                border: 1px solid;
                margin: 0;
                text-align: center;
            }

            .pagoAntes{
                font-weight: bold;
                text-align: center;
                font-size: 20px;
                color: #66ff66;
            }

            /*Parte derecha*/
            #datosPersonales{
                border: 1px solid;
            }

            #parteDerechaReserva{
                width: 70%;
                float: right;
            }

            #datosCasa{
                margin-top: 15px;
                float: left;
            }

            #datosCasa img{
                width: 30%;
                float: left;
            }

            #datosCasa label{
                font-size: 20px;
                display: block;
                margin: 0 0 10px 0;
            }
            #datosCasa > div{
                float: left;
                margin: 0 0 0 10px;
            }

            #reservaFinal{
                margin-top: 20px;
                width: 100%;
                float: left;
            }

            #alineamiento div{
                display: inline-block;
                margin: 15px 25px 15px 7px;
            }
            #alineamiento div label, #datosTarjeta div:not(:last-child) label{
                font-weight: bold;
                font-size: 22px;
                display: block;
                margin: 0 0 5px 0;
            }

            #alineamiento div *{
                font-size: 18px;
                display: block;
            }

            #pagoFinal{
                margin-top: 20px;
                float:left;
                width: 100%;
                border: 1px solid ;
            }

            #datosTarjeta{
                float: left;
            }

            #datosTarjeta div{
                display: inline-block;
                margin: 15px 25px 15px 7px;
            }

            #datosTarjeta div:first-child{
                width: 55%;
            }

            #datosTarjeta div *{
                display: block;
                font-size: 18px;
            }

            .inline select{
                display: inline-block !important;
                margin: 0 10px 0 1px;
            }

            #datosTarjeta div:nth-child(1) label{
                font-size: 18px;
                margin-bottom: 15px;
            }

            #datosTarjeta div:last-child{
                float: right;
            }

            #imagenTarjeta{
                float: right;
                width: 35%;
            }

            #imagenTarjeta img {
                width: 100%;
                display: none;
                opacity: 0;
            }

            #codigoPago{
                float:right;
            }

            #codigoPago *{
                display: block;
            }

        </style>

        <script>
            $(function () {
                $("#numeroTarjeta").keyup(function () {
                    var primeraLetra = $("#numeroTarjeta").val().substr(0, 1);
                    var longitudTarjeta = $("#numeroTarjeta").val().length;
                    if (longitudTarjeta == 1 || longitudTarjeta == 0) {
                        if (primeraLetra == '3') {
                            $("#imagenTarjeta img").css("display", "none");
                            $("#imagenTarjeta img").css("opacity", "0");
                            $(".american").css("display", "block");
                            $(".american").animate({opacity: 1}, 1000)
                        } else if (primeraLetra == '4') {
                            $("#imagenTarjeta img").css("display", "none");
                            $("#imagenTarjeta img").css("opacity", "0");
                            $(".visa").css("display", "block");
                            $(".visa").animate({opacity: 1}, 1000)
                        } else if (primeraLetra == '5') {
                            $("#imagenTarjeta img").css("display", "none");
                            $("#imagenTarjeta img").css("opacity", "0");
                            $(".mastercard").css("display", "block");
                            $(".mastercard").animate({opacity: 1}, 1000)
                        } else if (primeraLetra == '6') {
                            $("#imagenTarjeta img").css("display", "none");
                            $("#imagenTarjeta img").css("opacity", "0");
                            $(".discover").css("display", "block");
                            $(".discover").animate({opacity: 1}, 1000)
                        } else {
                            $("#imagenTarjeta img").animate({opacity: 0}, 1000)
                        }
                    }
                });
            });
        </script>
    </h:head>
    <h:body>

        <!-- CABECERA -->
        <div id="myModal" class="modal">
            <div id="tabs">
                <span class="close">&times;</span>
                <ul>
                    <li><a href="#tabs-1">Inicia sesión</a></li>
                    <li><a href="#tabs-2">Hazte una cuenta</a></li>
                </ul>
                <div id="tabs-1">
                    <h:form id="login" prependId="false">
                        <label><span>E-mail:</span><h:inputText class="input-field" value="#{bkLogin.email}"/></label>
                        <label><span>Contraseña:</span><h:inputText class="input-field" value="#{bkLogin.password}"/></label>
                        <p:commandButton value="Entrar" action="#{bkLogin.compruebaLogin()}" update="login cabecera perfilUsuarioGroup alineamiento errorInicia permisoUsu datosPago"/>
                        <label><span style="color:red; width: 100%;">#{bkLogin.mens}</span></label><br></br><br></br>
                        <h:outputLabel onclick="formRemember()" ><span id="rememberPass" style="width: 100% !important;">No recuerdo mi contraseña</span></h:outputLabel>
                    </h:form>

                    <h:form id="remember">
                        <label><span>Introduzca su email:</span><h:inputText class="input-field" value="#{bkLogin.destinatario}"/></label>
                        <p:commandButton value="Solicitar contraseña" action="#{bkLogin.rememberPassword()}" update="mensaje"/>
                        <h:panelGroup id="mensaje">
                            <h:outputLabel rendered="#{bkLogin.mensPass=='Introduzca un e-mail válido'}"><span style="width: 100%; color:red;">#{bkLogin.mensPass}</span></h:outputLabel>
                            <h:outputLabel rendered="#{bkLogin.mensPass!='Introduzca un e-mail válido'}"><span style="width: 100%; color:green;">#{bkLogin.mensPass}</span></h:outputLabel>
                            <br></br>
                        </h:panelGroup>

                    </h:form>

                </div>
                <div id="tabs-2">
                    <h:form prependId="false">
                        <p:selectBooleanCheckbox id="propietario" value="#{bkRegister.propietario}" itemLabel="Soy propietario">
                            <f:ajax render="viajero" listener="#{bkRegister.onActiveStatusChange}" />
                        </p:selectBooleanCheckbox>
                        <p:selectBooleanCheckbox id="viajero" value="#{bkRegister.viajero}" itemLabel="Soy viajero">
                            <f:ajax render="propietario" listener="#{bkRegister.onInactiveStatusChange}" />
                        </p:selectBooleanCheckbox><br></br><br></br>
                        <label><span>E-mail:</span><h:inputText class="input-field" value="#{bkRegister.email}"/></label>
                        <label><span>Contraseña:</span><h:inputText class="input-field" value="#{bkRegister.password}"/></label>
                        <label><span>Repita contraseña:</span><h:inputSecret class="input-field" value="#{bkRegister.passwordCertified}"/></label>

                        <p:commandButton value="Comenzar el registro" action="#{bkRegister.compruebaRegistro()}" update="mensajillo"/>
                        <h:outputLabel id="mensajillo"><span style="width: 100%; color: red;">#{bkRegister.mens}</span></h:outputLabel>
                    </h:form>  
                </div>
            </div>
        </div>

        <div id="contenedorBuscador">
            <h:panelGroup id="cabecera">
                <header>
                    <ul class="child">
                        <li id="lodestone">
                            <a href="index.xhtml">
                                <input type="image" src="images/Other/logoRuralBlanco.png" />
                            </a>
                        </li>
                        <li id="mogstation">
                            <div id="idiomas">
                                <h:outputLabel value="Idioma"/>
                                <h:commandButton image="images/Other/spain.png" />
                                <h:commandButton image="images/Other/english.png"/>
                            </div>
                        </li>

                        <li id="user">
                            <h:panelGroup id="noIniciado" rendered="#{bkLogin.comprobarRender(BkManageBeanSesion.log)}">
                                <button onclick="registro()" id="modal">Hazte una cuenta</button>
                                <button onclick="iniciaSesion()" id="modal">Inicia sesión</button>
                            </h:panelGroup>

                            <h:panelGroup id="iniciado" rendered="#{!bkLogin.comprobarRender(BkManageBeanSesion.log)}">
                                <h:commandButton image="images/FotoPerfil/#{BkManageBeanSesion.usuarioLog.fotoPerfil}" onclick="mostrarDatosUsuario('perfilUsuario')" rendered="#{BkManageBeanSesion.usuarioLog.fotoPerfil != ''}"/>
                                <h:commandButton image="images/Other/user.png" onclick="mostrarDatosUsuario('perfilUsuario')" rendered="#{BkManageBeanSesion.usuarioLog.fotoPerfil eq ''}"/>
                            </h:panelGroup>
                        </li>
                    </ul>
                </header>
            </h:panelGroup>

            <h:panelGroup id="perfilUsuarioGroup">
                <div id="perfilUsuario">
                    <ul>
                        <li>
                            <a><h:outputLabel value="Bienvenido #{BkManageBeanSesion.usuarioLog.nombre}"/></a>
                        </li>
                        <li>
                            <h:panelGroup rendered="#{bkLogin.comprobarPerfil(BkManageBeanSesion.perfil) eq 'propietario'}">
                                <a href="/RuralHouses/faces/ownerHouses.xhtml">Ir a mi perfil</a>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{bkLogin.comprobarPerfil(BkManageBeanSesion.perfil) eq 'viajero'}">
                                <a href="/RuralHouses/faces/viajeroReserva.xhtml">Ir a mi perfil</a>
                            </h:panelGroup>
                        </li>
                        <li>
                            <p:commandLink id="ajaxCerrarSesion2" update="login cabecera perfilUsuarioGroup" action="#{BkManageBeanSesion.logout('/RuralHouses/faces/index.xhtml')}" >
                                <i class="fas fa-power-off"></i> Cerrar sesión
                            </p:commandLink>
                        </li>
                    </ul>      
                </div>
            </h:panelGroup>
        </div>
        <!-- FIN CABECERA -->

        <div id="datosDeReserva">
            <h2 id="cabeceraDatos">Datos de la reserva</h2>
            <div id="entradaSalida">
                <h:outputLabel value="Entrada" class="neg"/>
                <h:outputLabel value="#{bkSearchEngine.devolverFechaEntrada}"/>
                <h:outputLabel value="Salida" class="neg"/>
                <h:outputLabel value="#{bkSearchEngine.devolverFechaSalida}"/>
                <h:outputLabel value="Estancia de #{bkSearchEngine.numeroNoches} noches" class="neg"/>
            </div>
            <div id="desglosePrecio">
                <h:outputLabel value="Desglose del precio" class="neg"/>
                <h:outputLabel value="Casa para #{bkSearchEngine.numeroPersonasAloj} personas: ">
                    <h:outputLabel value="#{bkSearchEngine.precioSinComision} €" class="neg der cifra"/>
                </h:outputLabel>
                <h:outputLabel value="Comision (8%): ">
                    <h:outputLabel value="#{bkSearchEngine.comision} €" class="neg der borderAbajo cifra"/>
                </h:outputLabel>
                <h:outputLabel value="Precio total para #{bkSearchEngine.numeroPersonasAloj} personas: ">
                    <h:outputLabel value="#{bkSearchEngine.precioConComision} €" class="neg der cifra"/>
                </h:outputLabel>
            </div>
            <div id="pagoAnticipado">
                <h:outputLabel value="¡Ahora solo pagas el #{bkSearchEngine.porcentajeAPagar} % para hacer la reserva!" class="pagoAntes">
                    <h:outputLabel value="#{bkSearchEngine.totalPagarAntesReserva} €" class="neg der cifra"/>
                </h:outputLabel>
                <h:outputLabel value="El resto lo recoge el propietario cuando llegue a #{bkSearchEngine.alojamiento.nombre}" style="text-align: center;"/>
            </div>
        </div>

        <div id="parteDerechaReserva">
            <div id="datosCasa">
                <p:graphicImage url="images/Alojamientos/#{bkSearchEngine.alojamiento.registroTurismo}/#{bkSearchEngine.alojamiento.imagenPrincipal}"/>
                <div>
                    <h:outputLabel value="#{bkSearchEngine.alojamiento.nombre}">
                        <p:rating value="#{bkReserva.puntuacionMediaAloj(bkSearchEngine.alojamiento.registroTurismo)}" stars="5" readonly="true"></p:rating>
                    </h:outputLabel>
                    <h:outputLabel value="#{bkSearchEngine.saberPueblo(bkSearchEngine.alojamiento.registroTurismo)} (#{bkSearchEngine.saberProvincia(bkSearchEngine.alojamiento.registroTurismo)})"/>
                    <h:outputLabel value="Puntuación" style="font-weight: bold;"/>
                    <h:outputLabel value="9,2" class="puntuacion"/>
                </div>
            </div>

            <div id="reservaFinal">

                <div id="datosPersonales">
                    <h2 id="cabeceraDatos">Datos personales</h2>
                    <h:panelGroup rendered="#{bkSearchEngine.usu==null}" id="errorInicia">
                        <h3><i class="fas fa-user" style="margin: 0 7px 0 7px"></i>Inicia sesión para continuar con la reserva</h3>
                    </h:panelGroup>
                    <h:panelGroup id="alineamiento">
                        <div>
                            <h:panelGroup rendered="#{bkSearchEngine.usu!=null}">
                                <h:outputLabel value="Nombre"/>
                                <h:inputText value="#{bkSearchEngine.saberNombre(bkSearchEngine.usu)}" disabled="true"/>
                            </h:panelGroup>
                        </div>
                        <div>
                            <h:panelGroup rendered="#{bkSearchEngine.usu!=null}">
                                <h:outputLabel value="Apellidos"/>
                                <h:inputText value="#{bkSearchEngine.saberApellidos(bkSearchEngine.usu)}" disabled="true"/>
                            </h:panelGroup>
                        </div>
                        <div>
                            <h:panelGroup rendered="#{bkSearchEngine.usu!=null}">
                                <h:outputLabel value="Nº de teléfono"/>
                                <h:inputText value="#{bkSearchEngine.saberTelefono(bkSearchEngine.usu)}" disabled="true"/>
                            </h:panelGroup>
                        </div>
                        <div>
                            <h:panelGroup rendered="#{bkSearchEngine.usu!=null}">
                                <h:outputLabel value="E-mail"/>
                                <h:inputText value="#{bkSearchEngine.saberMail(bkSearchEngine.usu)}" disabled="true"/>
                            </h:panelGroup>
                        </div>
                        <div>
                            <h:panelGroup rendered="#{bkSearchEngine.usu!=null}">
                                <h:outputLabel value="Confirmar e-mail"/>
                                <h:inputText value="#{bkSearchEngine.saberMail(bkSearchEngine.usu)}" disabled="true"/>
                            </h:panelGroup>
                        </div>
                    </h:panelGroup>
                </div>

                <div id="pagoFinal">
                    <h2 id="cabeceraDatos">Realizar pago</h2>
                    <h:panelGroup rendered="#{!bkLogin.comprobarRender(BkManageBeanSesion.log)}" id="permisoUsu">
                        <h:panelGroup rendered="#{bkSearchEngine.alojamiento.nif.nif  == bkSearchEngine.usu.nif}">
                            <h3><i class="fas fa-ban" style="margin: 0 7px 0 7px; color:red;"></i>Lo sentimos, no puedes reservar tu propio alojamiento</h3>
                        </h:panelGroup>
                    </h:panelGroup>
                    <h:panelGroup rendered="#{bkSearchEngine.usu==null}" id="errorInicias">
                        <h3><i class="fas fa-user" style="margin: 0 7px 0 7px"></i>Inicia sesión para continuar con la reserva</h3>
                    </h:panelGroup>
                    <h:panelGroup id="datosPago" rendered="#{!bkLogin.comprobarRender(BkManageBeanSesion.log) and bkSearchEngine.alojamiento.nif.nif  != bkSearchEngine.usu.nif}">
                        <h:panelGroup>
                            <div id="datosTarjeta">
                                <div>
                                    <div>
                                        <h:outputLabel value="Número de tarjeta"/>
                                        <h:inputText value="" id="numeroTarjeta"/>
                                    </div>
                                    <div>
                                        <h:outputLabel value="Nombre del titular"/>
                                        <h:inputText value=""/>
                                    </div>
                                    <div class="inline">
                                        <h:outputLabel value="Fecha de caducidad"/>
                                        <h:selectOneMenu>  
                                            <f:selectItem itemValue="" itemLabel="mm - Mes"/>
                                            <f:selectItems value="#{bkSearchEngine.obtenerMeses}"/>   
                                        </h:selectOneMenu>/
                                        <h:selectOneMenu>  
                                            <f:selectItem itemValue="" itemLabel="yyyy - Año"/>
                                            <f:selectItems value="#{bkSearchEngine.obtenerAnios}"/>    
                                        </h:selectOneMenu>
                                    </div>
                                    <div>
                                        <h:outputLabel value="Código CVC"/>
                                        <h:inputText value="" maxlength="3"/>
                                    </div>
                                    <div>
                                        <h:outputLabel value="Al reservar estás aceptando las condiciones generales y la política de privacidad "/>
                                        <h:outputLabel value="Le enviaremos un código a su correo electrónico para verificar el pago "/>
                                    </div>

                                </div>

                                <div id="imagenTarjeta">

                                    <p:graphicImage url="images/Other/americanExpress.png" class="american"/>
                                    <p:graphicImage url="images/Other/visa.png" class="visa"/>
                                    <p:graphicImage url="images/Other/mastercard.png" class="mastercard"/>
                                    <p:graphicImage url="images/Other/discover.jpg" class="discover"/>
                                </div>

                                <div id="codigoPago">
                                    <h:panelGroup rendered="#{bkSearchEngine.botonPagar=='clicado'}" id="codigop">
                                        <h:form>

                                            <h:inputText value="#{bkSearchEngine.codigoPagoIntroducido}"/>
                                            <p:commandButton value="Aceptar" action="#{bkSearchEngine.realizarPago()}" update="codigop"/>
                                            <h:outputLabel value="#{bkSearchEngine.respuesta}"/>
                                        </h:form>

                                    </h:panelGroup>
                                </div>

                                <div>
                                    <h:form>
                                        <h:commandButton value="Pagar y finalizar" action="#{bkSearchEngine.finalizarReserva()}"/>
                                    </h:form>
                                </div>
                            </div>
                        </h:panelGroup>
                    </h:panelGroup>
                </div>
            </div>
        </div>
    </h:body>

    <script>

        var modal = document.getElementById('myModal');
        var span = document.getElementsByClassName("close")[0];
        function iniciaSesion() {
            $("#tabs").css("display", "block");
            $("#myModal").css("display", "block");
            $("#tabs").tabs({
                active: 0
            });
        }

        function formRemember() {
            $("#remember").css("display", "block");
        }

        function registro() {
            $("#tabs").css("display", "block");
            $("#myModal").css("display", "block");
            $("#tabs").tabs({
                active: 1
            });
        }

        function mostrarDatosUsuario(id) {
            if (document.getElementById) { //se obtiene el id
                var el = document.getElementById(id); //se define la variable "el" igual a nuestro div
                el.style.display = (el.style.display == 'block') ? 'none' : 'block'; //damos un atributo display:none que oculta el div
            }
        }

        span.onclick = function () {
            $("#myModal").css("display", "none");
            $("#remember").css("display", "none");
        }

        window.onclick = function (event) {
            if (event.target == modal) {
                $("#myModal").css("display", "none");
                $("#remember").css("display", "none");
            }
        }

        PrimeFaces.locales['es'] = {
            prevText: 'Anterior',
            nextText: 'Siguiente',
            monthNames: ['Enero', 'febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
            monthNamesShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
            dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
            dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab'],
            dayNamesMin: ['D', 'L', 'M', 'X', 'J ', 'V', 'S '],
            firstDay: 1
        };
    </script>
</html>

