<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      >
    <f:view>
        <h:head>
            <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
            <title>Facelet Title</title>
            <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"></link>
            <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous"></link>
            <link rel="stylesheet" href="css/jquery.bxslider.css"></link>
            <link rel="stylesheet" href="css/jquery.bxslider.min.css"></link>
            <link rel="stylesheet" href="css/rh/cabecera.css"></link>
            <script src="js/jquery-ui.min.js"></script>
            <script src="js/filtrado.js"></script>
            <script src="js/jquery.easyPaginate.js"></script>
            <link rel="stylesheet" href="css/rh/footer.css"></link>

            <style>

                #tablaAlojamientos {
                    width: 60%;
                    float: right;
                    margin-top: 20px;
                }

                #alojamiento{
                    float: left;
                    width: 85%;
                    margin: 10px 10px 10px 0;
                    border: 2px solid #cfcfcf;
                    padding: 20px;
                    background: white;
                }

                #alojamiento:hover{
                    box-shadow: 3px 3px 10px #aaaaaa;
                }

                #alojamiento h4 i{
                    color: #777;
                    margin: 0 7px 0 7px;
                }

                #alojamiento h4 i:first-child{
                    margin-left:0px;
                }

                #alojamiento h4{
                    font-weight: normal;
                    margin: 13px;
                }

                .left{
                    float:left;
                }

                #alojamientoBarato{
                    margin: 60px;
                }

                #alojamientoBarato label{
                    font-size: 20px;
                }

                .ui-rating{
                    width: 90%;
                    margin: 8px 0 5px 40px;
                }

                #datosAloj{
                    width: 100% !important;
                    margin-left: 10px !important;
                }

                .imagenPpal{
                    float:left;
                    margin-right: 10px;
                }

                #precioAlojamiento{
                    float:right;
                }

                .precioCant{
                    font-size: 22px;
                    font-weight: bold;
                }
                .precioDato{
                    text-align: center;
                    font-size: 10px;
                }

                .submit{
                    float: right;
                    margin: 40px 5px 5px 0;
                    padding: 10px 25px;
                    border-radius: 5px;
                    border: 2px solid #cfcfcf;
                    color: #454545;
                    font-weight: bold;

                }

                .submit:hover{
                    background: #9daabc;
                    border: 2px solid #4e6788;
                    color: white;
                    cursor: pointer;

                }

                .easyPaginateNav{
                    width: 65% !important;
                    float: right;
                    text-align: center;
                    margin-top: 10px;
                    margin-bottom: 30px;
                }

                .first, .last{
                    display: none;
                }

                .easyPaginateNav a{
                    background: white;
                    border: 2px solid #73869f;
                    padding: 10px 15px;
                    margin: 3px;
                    text-decoration: none;
                    color: #454545;
                }

                .easyPaginateNav a{
                    background: white;
                    border: 2px solid #73869f;
                    padding: 10px 15px;
                    margin: 3px;
                    text-decoration: none;
                    color: #454545;
                }

                .easyPaginateNav a:hover:not(.current){
                    background: #e7e7e7 !important;
                }

                .current{
                    background: #73869f !important;
                    border: 2px solid #444 !important;
                    color: white !important;
                    padding: 13px 18px !important;
                }

                #filtradoAlojamientos{
                    width: 25%;
                    float: left;
                    border: 2px solid #cfcfcf;
                    padding: 20px;
                    margin: 30px 0 10px 20px;
                    background: white;
                }

                #filtradoAlojamientos label, .ui-selectoneradio tr td{
                    display: block;
                }

                #console{
                    width: 100%;
                }

                .ui-selectoneradio tr td{
                    float: left;
                    width: 100%
                }

                .ui-selectoneradio tr td label{
                    float: left;
                    margin: 3px 0 0 10px; 
                }

                .ui-radiobutton{
                    float: left;
                }


                .ui-autocomplete{
                    position: relative;
                }

                #modificarBuscador{
                    float: left;
                    border: 1px solid #cfcfcf;
                    padding: 20px;
                    width: 90%;
                }

                #modificarBuscador h3{
                    margin: 0;
                    padding: 5px;
                    text-align: center;
                }

                #modificarBuscador label{
                    display: block;
                    font-size: 15px;
                    margin: 22px 0 22px 0;
                }

                #modificarBuscador table label{
                    margin: 2px 0 20px 10px !important;
                }

                .buscador{
                    float: right;
                    margin: 40px 5px 5px 0;
                    padding: 5px 10px;
                    border-radius: 5px;
                    border: 2px solid #cfcfcf;
                    color: #454545;
                    font-weight: bold;
                }

                .buscador:hover{
                    background: #9daabc;
                    border: 2px solid #4e6788;
                    color: white;
                    cursor: pointer;
                }

                #themeCustom_input, #themeCustom{
                    width: 100%;
                }

                .neg{
                    font-size: 18px !important;
                    font-weight: bold;
                }

                .ui-state-highlight, .ui-widget-content .ui-state-highlight, .ui-widget-header .ui-state-highlight {
                    border: 1px solid #cfcfcf;
                    background: #617694;
                    color: white;
                }

                .fav{
                    width: 30px;
                    background: #0000; 
                    border: 0;
                    position: absolute;
                    margin: -10px;
                }

                .fav:hover{
                    background: #0000; 
                    border: 0;
                }

            </style>
        </h:head>
        <h:body>
            <!-- CABECERA -->
            <div id="myModal" class="modal">
                <div id="tabs">
                    <span class="close">&times;</span>
                    <ul>
                        <li><a href="#tabs-1">Inicia sesión</a></li>
                        <li><a href="#tabs-2">Hazte una cuenta</a></li>
                    </ul>
                    <div id="tabs-1">
                        <h:form id="login" prependId="false">
                            <label><span>E-mail:</span><h:inputText class="input-field" value="#{bkLogin.email}"/></label>
                            <label><span>Contraseña:</span><h:inputText class="input-field" value="#{bkLogin.password}"/></label>
                            <p:commandButton value="Entrar" action="#{bkLogin.compruebaLogin()}" update="login cabecera perfilUsuarioGroup tablaAlojamientos"/>
                            <label><span style="color:red; width: 100%;">#{bkLogin.mens}</span></label><br></br><br></br>
                            <h:outputLabel onclick="formRemember()" ><span id="rememberPass" style="width: 100% !important;">No recuerdo mi contraseña</span></h:outputLabel>
                        </h:form>

                        <h:form id="remember">
                            <label><span>Introduzca su email:</span><h:inputText class="input-field" value="#{bkLogin.destinatario}"/></label>
                            <p:commandButton value="Solicitar contraseña" action="#{bkLogin.rememberPassword()}" update="mensaje"/>
                            <h:panelGroup id="mensaje">
                                <h:outputLabel rendered="#{bkLogin.mensPass=='Introduzca un e-mail válido'}"><span style="width: 100%; color:red;">#{bkLogin.mensPass}</span></h:outputLabel>
                                <h:outputLabel rendered="#{bkLogin.mensPass!='Introduzca un e-mail válido'}"><span style="width: 100%; color:green;">#{bkLogin.mensPass}</span></h:outputLabel>
                                <br></br>
                            </h:panelGroup>

                        </h:form>

                    </div>
                    <div id="tabs-2">
                        <h:form prependId="false">
                            <p:selectBooleanCheckbox id="propietario" value="#{bkRegister.propietario}" itemLabel="Soy propietario">
                                <f:ajax render="viajero" listener="#{bkRegister.onActiveStatusChange}" />
                            </p:selectBooleanCheckbox>
                            <p:selectBooleanCheckbox id="viajero" value="#{bkRegister.viajero}" itemLabel="Soy viajero">
                                <f:ajax render="propietario" listener="#{bkRegister.onInactiveStatusChange}" />
                            </p:selectBooleanCheckbox><br></br><br></br>
                            <label><span>E-mail:</span><h:inputText class="input-field" value="#{bkRegister.email}"/></label>
                            <label><span>Contraseña:</span><h:inputText class="input-field" value="#{bkRegister.password}"/></label>
                            <label><span>Repita contraseña:</span><h:inputSecret class="input-field" value="#{bkRegister.passwordCertified}"/></label>

                            <p:commandButton value="Comenzar el registro" action="#{bkRegister.compruebaRegistro()}" update="mensajillo"/>
                            <h:outputLabel id="mensajillo"><span style="width: 100%; color: red;">#{bkRegister.mens}</span></h:outputLabel>
                        </h:form>  
                    </div>
                </div>
            </div>

            <div id="contenedorBuscador">
                <h:panelGroup id="cabecera">
                    <header>
                        <ul class="child">


                            <li id="lodestone">
                                <a href="index.xhtml">
                                    <input type="image" src="images/Other/logoRuralBlanco.png" />
                                </a>
                            </li>
                            <li id="mogstation">
                                <div id="idiomas">
                                    <h:outputLabel value="Idioma"/>
                                    <h:commandButton image="images/Other/spain.png" />
                                    <h:commandButton image="images/Other/english.png"/>
                                </div>
                            </li>

                            <li id="user">
                                <h:panelGroup id="noIniciado" rendered="#{bkLogin.comprobarRender(BkManageBeanSesion.log)}">
                                    <button onclick="registro()" id="modal">Hazte una cuenta</button>
                                    <button onclick="iniciaSesion()" id="modal">Inicia sesión</button>
                                </h:panelGroup>

                                <h:panelGroup id="iniciado" rendered="#{!bkLogin.comprobarRender(BkManageBeanSesion.log)}">
                                    <h:commandButton image="images/FotoPerfil/#{BkManageBeanSesion.usuarioLog.fotoPerfil}" onclick="mostrarDatosUsuario('perfilUsuario')" rendered="#{BkManageBeanSesion.usuarioLog.fotoPerfil != ''}"/>
                                    <h:commandButton image="images/Other/user.png" onclick="mostrarDatosUsuario('perfilUsuario')" rendered="#{BkManageBeanSesion.usuarioLog.fotoPerfil eq ''}"/>
                                </h:panelGroup>
                            </li>
                        </ul>
                    </header>
                </h:panelGroup>

                <h:panelGroup id="perfilUsuarioGroup">
                    <div id="perfilUsuario">
                        <ul>
                            <li>
                                <a><h:outputLabel value="Bienvenido #{BkManageBeanSesion.usuarioLog.nombre}"/></a>
                            </li>
                            <li>
                                <h:panelGroup rendered="#{bkLogin.comprobarPerfil(BkManageBeanSesion.perfil) eq 'propietario'}">
                                    <a href="/RuralHouses/faces/ownerHouses.xhtml">Ir a mi perfil</a>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{bkLogin.comprobarPerfil(BkManageBeanSesion.perfil) eq 'viajero'}">
                                    <a href="/RuralHouses/faces/viajeroReserva.xhtml">Ir a mi perfil</a>
                                </h:panelGroup>
                            </li>
                            <li>
                                <p:commandLink id="ajaxCerrarSesion2" update="login cabecera perfilUsuarioGroup" action="#{BkManageBeanSesion.logout('/RuralHouses/faces/index.xhtml')}" >
                                    <i class="fas fa-power-off"></i> Cerrar sesión
                                </p:commandLink>
                            </li>
                        </ul>      
                    </div>
                </h:panelGroup>
            </div>
            <!-- FIN CABECERA -->

            <div id="filtradoAlojamientos">                
                <h:form id="modificarBuscador" prependId="false">

                    <h2>Buscar</h2>
                    <p:autoComplete id="themeCustom" value="#{bkSearchEngine.objetoBuscado}" completeMethod="#{bkIndex.completeTheme}"
                                    var="theme" itemLabel="#{bkSearchEngine.verNombre(theme)}" itemValue="#{theme.codigo}" placeholder="¿Dónde quieres viajar?" minQueryLength="2" scrollHeight="300">
                        <p:column rendered="#{theme.imagen=='zona.png'}">
                            <p:graphicImage url="images/Other/zona.png" styleClass="ui-theme" width="40" height="40"/>
                        </p:column>
                        <p:column rendered="#{theme.imagen=='pueblo.png'}">
                            <p:graphicImage url="images/Other/pueblo.png" styleClass="ui-theme" width="40" height="40"/>
                        </p:column>
                        <p:column rendered="#{theme.imagen != '' and theme.tipoObjeto=='alojamiento'}" >
                            <p:graphicImage url="images/Alojamientos/#{theme.codigo}/#{theme.imagen}" styleClass="ui-theme" width="40" height="40"/>
                        </p:column>
                        <p:column rendered="#{theme.imagen =='' and theme.tipoObjeto=='alojamiento'}" >
                            <p:graphicImage url="images/Alojamientos/noAvailable.jpg" styleClass="ui-theme" width="40" height="40"/>
                        </p:column>
                        <p:column>
                            <h:outputText value="#{theme.nombre}" />
                        </p:column>
                    </p:autoComplete>

                    <h:outputLabel value="#{bkSearchEngine.solucion}" style="color: red"/>

                    <h:outputLabel value="Precio medio" class="neg"/>
                    <p:selectOneRadio id="console">
                        <f:selectItem itemLabel="Menos de 20€ /per " itemValue="20" />
                        <f:selectItem itemLabel="Entre 20 y 30€ /per" itemValue="25" />
                        <f:selectItem itemLabel="Más de 30€ /per" itemValue="30" />
                    </p:selectOneRadio>
                    <h:outputLabel value="Fecha de entrada" class="neg"/>
                    <p:calendar id="entrada" value="#{bkSearchEngine.fechaEnt}" mindate="today" placeholder="Entrada" pattern="dd/MM/yyyy" locale="es" >
                        <p:ajax event="dateSelect" update="salida"/>
                    </p:calendar>

                    <h:outputLabel value="Fecha de salida" class="neg"/>
                    <p:calendar id="salida" value="#{bkSearchEngine.fechaSal}" mindate="#{bkSearchEngine.minDateSal}" pattern="dd/MM/yyyy" placeholder="Salida" locale="es"/>

                    <h:outputLabel value="Estancia de #{bkSearchEngine.numeroNoches} noches" class="neg"/>
                    <h:outputLabel value="Número de personas" class="neg"/>
                    <h:selectOneMenu value="#{bkSearchEngine.numeroPersonas}">  
                        <f:selectItem itemValue="" itemLabel="Personas"/>
                        <f:selectItems value="#{bkIndex.listaPersonasBuscar}"/>    
                    </h:selectOneMenu>
                    <h:commandButton value="Comprobar disponibilidad" action="#{bkSearchEngine.buscar()}" class="buscador"/>
                </h:form>



            </div>

            <h:panelGroup rendered="#{bkSearchEngine.listadoAlojamientosBuscados.size()>0}">
                <h1 style="text-align: center;">#{bkSearchEngine.listadoAlojamientosBuscados.size()} alojamientos coinciden con tu búsqueda</h1>
            </h:panelGroup>
            <h:panelGroup rendered="#{bkSearchEngine.listadoAlojamientosBuscados.size()==0}">
                <h2 style="text-align: center;">Su búsqueda no ha dado frutos... Pruebe con otra combinación de destinos y fechas!!</h2>
            </h:panelGroup>
            <h:panelGroup id="tablaAlojamientos">
                <ui:repeat var="alojamiento" value="#{bkSearchEngine.listadoAlojamientosBuscados}"> 
                    <div id="alojamiento" class="pagino buscar">
                        <h:panelGroup rendered="#{!bkLogin.comprobarRender(BkManageBeanSesion.log)}">
                            <h:form>
                                <h:commandButton image="images/Other/heart.png" class="fav" rendered="#{!bkSearchEngine.comprobarFavorito(alojamiento.registroTurismo)}" action="#{bkSearchEngine.marcarFavorito(alojamiento.registroTurismo)}"/>
                                <h:commandButton image="images/Other/heartRed.png" class="fav" rendered="#{bkSearchEngine.comprobarFavorito(alojamiento.registroTurismo)}" action="#{bkSearchEngine.desmarcarFavorito(alojamiento.registroTurismo)}"/>
                            </h:form>
                        </h:panelGroup>

                        <h:form prependId="false">
                            <input type="hidden" value="#{alojamiento.precioNoche}" class="precioAlojHidden"/>
                            <div id="precioAlojamiento">
                                <h:outputLabel value="#{alojamiento.precioNoche} € " class="precioCant"><br></br>
                                    <h:outputLabel value="persona y noche" class="precioDato"/>
                                </h:outputLabel>
                            </div>
                            <h:graphicImage url="images/Alojamientos/#{alojamiento.registroTurismo}/#{alojamiento.imagenPrincipal}" class="imagenPpal" style="width:27%;" rendered="#{alojamiento.imagenPrincipal != ''}"></h:graphicImage>
                            <h:graphicImage url="images/Alojamientos/noAvailable.jpg" class="imagenPpal" style="width:27%; height: 150px;" rendered="#{alojamiento.imagenPrincipal == ''}"></h:graphicImage>

                            <div id="datosAloj">
                                <h:outputLabel value="#{alojamiento.nombre} (#{bkSearchEngine.saberPueblo(alojamiento.registroTurismo)})" class="margin"></h:outputLabel><br></br>
                                <p:rating value="#{bkReserva.puntuacionMediaAloj(alojamiento.registroTurismo)}" stars="5" readonly="true"></p:rating>

                                <h4><i class="fas fa-users"></i>1-#{alojamiento.plazasMax} personas <i class="fas fa-bed"></i>#{alojamiento.numeroHab} habitaciones <i class="fas fa-bath"></i>#{alojamiento.numeroWc} baños</h4>
                                <h:outputLabel value="#{alojamiento.comentario}" class="margin"></h:outputLabel>
                            </div>
                            <h:commandButton value="Ir al alojamiento" action="#{bkSearchEngine.mostrarAlojamiento(alojamiento.registroTurismo)}" class="submit"></h:commandButton>
                        </h:form>
                    </div>
                </ui:repeat>

            </h:panelGroup>

            <footer class="flex">
                <ul class="footColumna">
                    <li><h3 class="tituloColumna">Nosotros</h3></li>
                    <li><a href="#">CONDICIONES DE USO</a></li>
                    <li><a href="#">POLITICA DE PRIVACIDAD</a></li>
                    <li><a href="#">COOKIES</a></li>
                    <li><a href="#">CONTACTAR</a></li>
                </ul>
                <ul class="footColumna">
                    <li><h3 class="tituloColumna">Propietarios</h3></li>
                    <li><a href="#">DESTACA TU ALOJAMIENTO</a></li>
                    <li><a href="#">CONSEJOS</a></li>
                </ul>
                <ul class="footColumna">
                    <li><h3 class="tituloColumna">Viajeros</h3></li>
                    <li><a href="#">CASAS RURALES</a></li>
                    <li><a href="#">PUEBLOS</a></li>
                </ul>

                <section class="footer-social-section flex">
                    <span class="footer-social-overlap footer-social-connect">
                        CONECTA <span class="footer-social-small">CON</span> NOSOTROS
                    </span>
                    <span class="footer-social-overlap footer-social-icons-wrapper">
                        <a href="https://www.facebook.com/paviliongift" class="generic-anchor" target="_blank" title="Facebook" ><i class="fab fa-facebook-f"></i></a>
                        <a href="https://twitter.com/PavilionGiftCo" class="generic-anchor" target="_blank" title="Twitter" ><i class="fab fa-twitter"></i></a>
                        <a href="http://instagram.com/paviliongiftcompany" class="generic-anchor" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>
                    </span>
                </section>
            </footer>

        </h:body>
        <script>

            PrimeFaces.locales['es'] = {
                prevText: 'Anterior',
                nextText: 'Siguiente',
                monthNames: ['Enero', 'febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
                monthNamesShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
                dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab'],
                dayNamesMin: ['D', 'L', 'M', 'X', 'J ', 'V', 'S '],
                firstDay: 1
            };
            var modal = document.getElementById('myModal');
            var span = document.getElementsByClassName("close")[0];
            function iniciaSesion() {
                $("#tabs").css("display", "block");
                $("#myModal").css("display", "block");
                $("#tabs").tabs({
                    active: 0
                });
            }

            function formRemember() {
                $("#remember").css("display", "block");
            }

            function registro() {
                $("#tabs").css("display", "block");
                $("#myModal").css("display", "block");
                $("#tabs").tabs({
                    active: 1
                });
            }

            function mostrarDatosUsuario(id) {
                if (document.getElementById) { //se obtiene el id
                    var el = document.getElementById(id); //se define la variable "el" igual a nuestro div
                    el.style.display = (el.style.display == 'block') ? 'none' : 'block'; //damos un atributo display:none que oculta el div
                }
            }

            span.onclick = function () {
                $("#myModal").css("display", "none");
                $("#remember").css("display", "none");
            }

            window.onclick = function (event) {
                if (event.target == modal) {
                    $("#myModal").css("display", "none");
                    $("#remember").css("display", "none");
                }
            }

            $('body').on('mousedown', '.ui-autocomplete-panel', function (event) {
                event.stopImmediatePropagation();
            });



            $('#tablaAlojamientos').easyPaginate({
                paginateElement: '.pagino',
                elementsPerPage: 4
            });

            $(".prev").html("Anterior");
            $(".next").html("Siguiente");
            $('#entrada_input').attr('readonly', true);
            $('#salida_input').attr('readonly', true);







        </script>
    </f:view>
</html>

